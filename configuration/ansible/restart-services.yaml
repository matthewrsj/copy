---
# ansible-playbook -l <host_group> restart-services.yaml -K
- hosts: all
  tasks:
  - name: Reload Configurations
    shell: systemctl daemon-reload
    become: yes
    become_method: sudo
    tags:
      - canup
      - protostream
      - towercontroller
      - towerstreamsvc
      - daemon-reload
  - name: Restart canup
    service:
      name: canup.service
      state: restarted
    become: yes
    become_method: sudo
    tags:
      - canup
  - name: Update protostream docker image
    command: docker pull artifactory.teslamotors.com:2132/formation-docker-local/protostreamapp:latest
    become: yes
    become_method: sudo
    tags:
      - protostream
  - name: Restart protostream
    service:
      name: protostream.service
      state: restarted
    become: yes
    become_method: sudo
    tags:
      - protostream
  - name: Update towercontroller docker image
    command: docker pull artifactory.teslamotors.com:2132/formation-docker-local/towercontrollerapp:latest
    become: yes
    become_method: sudo
    tags:
      - towercontroller
  - name: Restart towercontroller
    service:
      name: towercontroller.service
      state: restarted
    become: yes
    become_method: sudo
    tags:
      - towercontroller
  - name: Update towerstreamsvc docker image
    command: docker pull artifactory.teslamotors.com:2132/formation-docker-local/towerstreamsvc:latest
    become: yes
    become_method: sudo
    tags:
      - towerstreamsvc
  - name: Restart towerstreamsvc
    service:
      name: towerstreamsvc.service
      state: restarted
    become: yes
    become_method: sudo
    tags:
      - towerstreamsvc
  - name: Update watchtower docker image
    command: docker pull artifactory.teslamotors.com:2132/formation-docker-local/watchtowerapp:latest
    become: yes
    become_method: sudo
    tags:
      - watchtower
  - name: Restart watchtower
    service:
      name: watchtower.service
      state: restarted
    become: yes
    become_method: sudo
    tags:
      - watchtower
